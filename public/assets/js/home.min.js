const backsound=new Audio("assets/audios/backsound.mp3"),loading=document.querySelector("#loading"),floatingButtons=document.querySelector(".floating-buttons"),backsoundToggler=document.querySelector("#btn-backsound-toggler"),csrf=document.querySelector("meta[name=csrf]").getAttribute("content"),baseUrl=document.querySelector("meta[name=url]").getAttribute("content");function initAOS(){AOS.init({offset:120,duration:750,easing:"ease-in-out",once:!0})}function openInvitation(){const e=document.querySelector(".onboarding"),t=document.querySelector("main"),n=document.querySelector("main #hero .scroll-info");t.classList.remove("d-none"),t.classList.add("openned"),e.classList.add("closed"),setTimeout((()=>{n.style.opacity=1}),100),initAOS(),playBacksound()}function setCountdown(){const e=new Date("2025-2-15")-new Date,t=Math.floor(e/864e5);document.querySelector(".timer-days .number").textContent=t}function copyToClipboard(e,t){const n=document.querySelector(t),s=document.createElement("textarea"),o=e.target.parentElement.querySelector(".btn-copied");s.value=n.innerText,document.body.appendChild(s),s.select(),s.setSelectionRange(0,99999),navigator.clipboard.writeText(s.value).then((function(){o.classList.remove("hidden"),setTimeout((()=>{o.classList.add("hidden")}),2e3)}),(function(e){console.error(e)})),document.body.removeChild(s)}function toggleGuestCount(e){const t="1"==e.target.value,n=document.querySelector(".guest-count-wrapper"),s=n.querySelector("select[name=num_guest]");t?n.classList.remove("d-none"):(n.classList.add("d-none"),s.selectedIndex=0,document.querySelectorAll(".partner-name-wrapper .input-group").forEach((e=>e.remove())))}function showPartnerInput(e){const t=e.target.value,n=document.querySelector(".partner-name-wrapper");if(n.querySelectorAll(".input-group").forEach((e=>e.remove())),t>=2)for(let e=2;e<=t;e++){const t=document.createElement("div");t.innerHTML=`\n                <div class="input-group mb-3">\n                    <input name="guest${e}name" type="text"\n                        class="form-control text-italic fs-16 fw-400 ff-fira-sans"\n                        placeholder="Your partner's name" aria-label="Partner's Name" required>\n                </div>\n            `,n.appendChild(t.firstElementChild)}}function fetchRsvpsDesktop(){fetch(`${baseUrl}/rsvps`).then((e=>e.json())).then((({rsvps:e})=>{if(!e.length)return document.querySelector(".swiper-wishes-wrapper-lg .comments-wrapper").classList.add("d-none"),void document.querySelector(".swiper-wishes-wrapper-lg .comments-empty-placeholder").classList.remove("d-none");document.querySelector(".swiper-wishes-wrapper-lg .comments-wrapper").classList.remove("d-none"),document.querySelector(".swiper-wishes-wrapper-lg .comments-empty-placeholder").classList.add("d-none");const t=document.querySelector(".swiper-wishes-wrapper-lg .comments-wrapper");t.querySelectorAll(".swiper-wishes").forEach((e=>e.remove()));const n=e.length<10?[e]:[e.slice(0,Math.ceil(e.length/2)),e.slice(Math.ceil(e.length/2))],s=document.createElement("div");s.innerHTML=n.map(((e,t)=>`\n                <div class="swiper swiper-wishes swiper-wishes-${t+1}" style="margin-bottom: 12px;">\n                    <div class="swiper-wrapper">\n                        ${e.map((e=>`\n                            <div class="swiper-slide rounded-8 h-100 overflow-hidden">\n                                ${generateWishCard(e)}\n                            </div>\n                        `)).join("")}\n                    </div>\n                </div>\n            `)).join(""),t.appendChild(s),n.forEach(((e,t)=>{const n=document.querySelector(`.swiper-wishes-${t+1}`);n&&new Swiper(n,{spaceBetween:12,slidesPerView:3,loop:!0,freeMode:!0,speed:7e3+3e3*t,autoplay:{delay:0,disableOnInteraction:!1,pauseOnMouseEnter:!0},breakpoints:{1024:{slidesPerView:4}}})}))})).catch((e=>{console.error(e)}))}function fetchRsvpsMobile(e=5,t=!1){const n=document.querySelector(".swiper-wishes-wrapper-sm .comments-wrapper"),s=n.querySelectorAll(".comment-item"),o=document.querySelector("#comments button.btn-load-more");let r=e,a=0;r=t&&s.length<=e?e:t?s.length:s.length+e,o.setAttribute("disabled",!0),fetch(`${baseUrl}/rsvps?limit=${r}`).then((e=>e.json())).then((({rsvps:e,remaining:t})=>{if(a=t,!e.length)return document.querySelector(".swiper-wishes-wrapper-sm .comments-wrapper").classList.add("d-none"),document.querySelector(".swiper-wishes-wrapper-sm .comments-actions").classList.add("d-none"),void document.querySelector(".swiper-wishes-wrapper-sm .comments-empty-placeholder").classList.remove("d-none");document.querySelector(".swiper-wishes-wrapper-sm .comments-wrapper").classList.remove("d-none"),document.querySelector(".swiper-wishes-wrapper-sm .comments-actions").classList.remove("d-none"),document.querySelector(".swiper-wishes-wrapper-sm .comments-empty-placeholder").classList.add("d-none"),s.forEach((e=>e.remove())),[...e].forEach(((t,s)=>{const o=document.createElement("div"),r=s+1==e.length;o.innerHTML=generateWishCard(t,!0,r),n.appendChild(o.firstElementChild)}))})).catch((e=>{console.error(e)})).finally((()=>{a?(o.removeAttribute("disabled"),o.style.opacity=1):(o.setAttribute("disabled",!0),o.style.opacity=0)}))}function storeRsvp(e){e.preventDefault();const t=e.target,n=new FormData(t),s=t.querySelector("button[type=submit]");validateRsvp(n.get("invitation_id"),(function(){s.setAttribute("disabled",!0),fetch(`${baseUrl}/rsvps`,{method:"POST",headers:{Accept:"application/json","X-CSRF-TOKEN":csrf},body:n}).then((e=>e.json())).then((()=>{t.reset(),document.querySelector(".guest-count-wrapper select").value="",document.querySelectorAll(".partner-name-wrapper .input-group").forEach((e=>e.remove())),fetchRsvpsDesktop(),fetchRsvpsMobile(5,!0),toastSuccess("Thank you for your confirmation and blessing!")})).catch((e=>{console.error(e)})).finally((()=>{s.removeAttribute("disabled")}))}))}function validateRsvp(e,t){fetch(`${baseUrl}/rsvps/check/${e}`).then((e=>e.json())).then((({exists:e})=>{e?toastWarning("You already submitted an RSVP."):t()})).catch((e=>{console.error(e)}))}function generateWishCard(e,t=!1,n=!0){return`\n        <div class="comment-item rounded-8 ${n?"":"mb-3"} bg-white p-4 ${t?"":"h-100"}">\n            <span class="d-block fs-16 fw-500 ff-fira-sans mb-2 text-black">\n                ${e.full_name}\n            </span>\n            <p class="text-primary-light fs-16 fw-400 ff-fira-sans m-0 mb-2 p-0">\n                ${e.greetings_escaped}\n            </p>\n            <div class="d-flex gap-2">\n                <img src="${baseUrl}/assets/images/icons/clock-primary-light.svg" alt="Clock icon">\n                <span class="d-inline-block text-primary-lightest fs-13 fw-400 ff-fira-sans">\n                    ${e.create_date_diff}\n                </span>\n            </div>\n        </div>\n    `}function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}function playBacksound(){backsound.play(),backsoundToggler.querySelector(".up").classList.remove("d-none"),backsoundToggler.querySelector(".mute").classList.add("d-none")}function pauseBacksound(){backsound.pause(),backsoundToggler.querySelector(".mute").classList.remove("d-none"),backsoundToggler.querySelector(".up").classList.add("d-none")}function toggleBacksound(){backsound.paused?playBacksound():pauseBacksound()}document.addEventListener("DOMContentLoaded",(function(){new Swiper(".swiper-gallery",{spaceBetween:20,slidesPerView:1.2,breakpoints:{1024:{slidesPerView:3}}}),setCountdown(),setInterval((()=>{setCountdown()}),36e5),fetchRsvpsDesktop(),fetchRsvpsMobile()})),window.addEventListener("load",(function(){loading.classList.add("loaded"),setTimeout((()=>{loading.remove()}),500)})),window.addEventListener("scroll",(function(){this.window.scrollY>=300?floatingButtons.style.opacity=1:floatingButtons.style.opacity=0}));