const backsound=new Audio("assets/audios/backsound.mp3"),loading=document.querySelector("#loading"),csrf=document.querySelector("meta[name=csrf]").getAttribute("content"),baseUrl=document.querySelector("meta[name=url]").getAttribute("content");let currentRsvpPage=1;function initAOS(){AOS.init({offset:120,duration:750,easing:"ease-in-out",once:!0})}function openInvitation(){const e=document.querySelector(".onboarding"),t=document.querySelector("main");t.classList.remove("d-none"),t.classList.add("openned"),e.classList.add("closed"),initAOS(),backsound.play()}function setCountdown(){const e=new Date("2025-2-15")-new Date,t=Math.floor(e/864e5);document.querySelector(".timer-days .number").textContent=t}function copyToClipboard(e,t){const n=document.querySelector(t),s=document.createElement("textarea"),o=e.target.parentElement.querySelector(".btn-copied");s.value=n.innerText,document.body.appendChild(s),s.select(),s.setSelectionRange(0,99999),navigator.clipboard.writeText(s.value).then((function(){o.classList.remove("hidden"),setTimeout((()=>{o.classList.add("hidden")}),2e3)}),(function(e){console.error(e)})),document.body.removeChild(s)}function toggleGuestCount(e){const t="1"==e.target.value,n=document.querySelector(".guest-count-wrapper"),s=n.querySelector("select[name=num_guest]");t?n.classList.remove("d-none"):(n.classList.add("d-none"),s.selectedIndex=0,document.querySelectorAll(".partner-name-wrapper .input-group").forEach((e=>e.remove())))}function showPartnerInput(e){const t=e.target.value,n=document.querySelector(".partner-name-wrapper");if(n.querySelectorAll(".input-group").forEach((e=>e.remove())),t>=2)for(let e=2;e<=t;e++){const t=document.createElement("div");t.innerHTML=`\n                <div class="input-group mb-3">\n                    <input name="guest${e}name" type="text"\n                        class="form-control text-italic fs-16 fw-400 ff-fira-sans"\n                        placeholder="Your partner's name" aria-label="Partner's Name" required>\n                </div>\n            `,n.appendChild(t.firstElementChild)}}function fetchRsvps(e=currentRsvpPage,t=5){const n=document.querySelector(".comments-wrapper"),s=n.querySelectorAll(".comment-item");fetch(`${baseUrl}/rsvps?page=${e}&perPage=${t}`).then((e=>e.json())).then((({rsvps:t,remaining:o})=>{0!=t.length&&(s.forEach((e=>e.remove())),[...t].forEach(((e,s)=>{const o=document.createElement("div"),r=s+1==t.length;o.innerHTML=`\n                    <div class="comment-item rounded-8 ${r?"":"mb-3"} bg-white p-4">\n                        <span class="d-block fs-16 fw-500 ff-fira-sans mb-2 text-black">\n                            ${e.full_name}\n                        </span>\n                        <p class="text-primary-light fs-16 fw-400 ff-fira-sans m-0 mb-2 p-0">\n                            ${e.greetings_escaped}\n                        </p>\n                        <div class="d-flex gap-2">\n                            <img src="${baseUrl}/assets/images/icons/clock-primary-light.svg" alt="Clock icon">\n                            <span class="d-inline-block text-primary-lightest fs-13 fw-400 ff-fira-sans">\n                                ${e.create_date_diff}\n                            </span>\n                        </div>\n                    </div>\n                `,n.appendChild(o.firstElementChild)})),currentRsvpPage=e)})).catch((e=>{console.error(e)}))}function fetchPrevRsvps(){1!=currentRsvpPage&&fetchRsvps(currentRsvpPage-1)}function fetchNextRsvps(){fetchRsvps(currentRsvpPage+1)}function storeRsvp(e){e.preventDefault();const t=e.target,n=new FormData(t),s=t.querySelector("button[type=submit]");validateRsvp(n.get("invitation_id"),(function(){s.setAttribute("disabled",!0),fetch(`${baseUrl}/rsvps`,{method:"POST",headers:{Accept:"application/json","X-CSRF-TOKEN":csrf},body:n}).then((e=>e.json())).then((()=>{t.reset(),document.querySelector(".guest-count-wrapper select").value="",document.querySelectorAll(".partner-name-wrapper .input-group").forEach((e=>e.remove())),toastSuccess("Thank you for your confirmation and blessing!")})).catch((e=>{console.error(e)})).finally((()=>{s.removeAttribute("disabled")}))}))}function updateRsvp(e){e.preventDefault();const t=e.target,n=new FormData(t),s=t.querySelector("button[type=submit]"),o=n.get("invitation_id");validateRsvpWishes(o,(function(){s.setAttribute("disabled",!0),fetch(`${baseUrl}/rsvps/${o}`,{method:"POST",headers:{Accept:"application/json","X-CSRF-TOKEN":csrf},body:n}).then((e=>e.json())).then((()=>{t.reset(),fetchRsvps(1),toastSuccess("Thank you for your lovely wishes!")})).catch((e=>{console.error(e)})).finally((()=>{s.removeAttribute("disabled")}))}))}function validateRsvp(e,t){fetch(`${baseUrl}/rsvps/check/${e}`).then((e=>e.json())).then((({exists:e})=>{e?toastWarning("You already submitted an RSVP."):t()})).catch((e=>{console.error(e)}))}function validateRsvpWishes(e,t){fetch(`${baseUrl}/rsvps/check/${e}/wishes`).then((e=>e.json())).then((({exists:e})=>{e?toastWarning("You already submitted a wishes message."):t()})).catch((e=>{console.error(e)}))}document.addEventListener("DOMContentLoaded",(function(){new Swiper(".swiper-gallery",{spaceBetween:20,slidesPerView:1.2,breakpoints:{1024:{slidesPerView:3}}}),setCountdown(),setInterval((()=>{setCountdown()}),36e5),fetchRsvps()})),window.addEventListener("load",(function(){loading.classList.add("loaded"),setTimeout((()=>{loading.remove()}),500)}));