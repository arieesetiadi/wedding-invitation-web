const backsound=new Audio("assets/audios/backsound.mp3"),loading=document.querySelector("#loading"),floatingButtons=document.querySelector(".floating-buttons"),backsoundToggler=document.querySelector("#btn-backsound-toggler"),csrf=document.querySelector("meta[name=csrf]").getAttribute("content"),baseUrl=document.querySelector("meta[name=url]").getAttribute("content");let currentRsvpPage=1;function initAOS(){AOS.init({offset:120,duration:750,easing:"ease-in-out",once:!0})}function openInvitation(){const e=document.querySelector(".onboarding"),t=document.querySelector("main");t.classList.remove("d-none"),t.classList.add("openned"),e.classList.add("closed"),initAOS(),playBacksound()}function setCountdown(){const e=new Date("2025-2-15")-new Date,t=Math.floor(e/864e5);document.querySelector(".timer-days .number").textContent=t}function copyToClipboard(e,t){const n=document.querySelector(t),o=document.createElement("textarea"),s=e.target.parentElement.querySelector(".btn-copied");o.value=n.innerText,document.body.appendChild(o),o.select(),o.setSelectionRange(0,99999),navigator.clipboard.writeText(o.value).then((function(){s.classList.remove("hidden"),setTimeout((()=>{s.classList.add("hidden")}),2e3)}),(function(e){console.error(e)})),document.body.removeChild(o)}function toggleGuestCount(e){const t="1"==e.target.value,n=document.querySelector(".guest-count-wrapper"),o=n.querySelector("select[name=num_guest]");t?n.classList.remove("d-none"):(n.classList.add("d-none"),o.selectedIndex=0,document.querySelectorAll(".partner-name-wrapper .input-group").forEach((e=>e.remove())))}function showPartnerInput(e){const t=e.target.value,n=document.querySelector(".partner-name-wrapper");if(n.querySelectorAll(".input-group").forEach((e=>e.remove())),t>=2)for(let e=2;e<=t;e++){const t=document.createElement("div");t.innerHTML=`\n                <div class="input-group mb-3">\n                    <input name="guest${e}name" type="text"\n                        class="form-control text-italic fs-16 fw-400 ff-fira-sans"\n                        placeholder="Your partner's name" aria-label="Partner's Name" required>\n                </div>\n            `,n.appendChild(t.firstElementChild)}}function fetchRsvps(e=currentRsvpPage,t=5){const n=document.querySelector(".comments-wrapper"),o=n.querySelectorAll(".comment-item");fetch(`${baseUrl}/rsvps?page=${e}&perPage=${t}`).then((e=>e.json())).then((({rsvps:t,remaining:s})=>{if(!t.length)return document.querySelector(".comments-wrapper").classList.add("d-none"),document.querySelector(".comments-actions").classList.add("d-none"),void document.querySelector(".comments-empty-placeholder").classList.remove("d-none");document.querySelector(".comments-wrapper").classList.remove("d-none"),document.querySelector(".comments-actions").classList.remove("d-none"),document.querySelector(".comments-empty-placeholder").classList.add("d-none"),e<=1?document.querySelector(".btn-rsvp-prev").classList.add("disabled"):document.querySelector(".btn-rsvp-prev").classList.remove("disabled"),s?document.querySelector(".btn-rsvp-next").classList.remove("disabled"):document.querySelector(".btn-rsvp-next").classList.add("disabled"),0!=t.length&&(o.forEach((e=>e.remove())),[...t].forEach(((e,o)=>{const s=document.createElement("div"),r=o+1==t.length;s.innerHTML=`\n                    <div class="comment-item rounded-8 ${r?"":"mb-3"} bg-white p-4">\n                        <span class="d-block fs-16 fw-500 ff-fira-sans mb-2 text-black">\n                            ${e.full_name}\n                        </span>\n                        <p class="text-primary-light fs-16 fw-400 ff-fira-sans m-0 mb-2 p-0">\n                            ${e.greetings_escaped}\n                        </p>\n                        <div class="d-flex gap-2">\n                            <img src="${baseUrl}/assets/images/icons/clock-primary-light.svg" alt="Clock icon">\n                            <span class="d-inline-block text-primary-lightest fs-13 fw-400 ff-fira-sans">\n                                ${e.create_date_diff}\n                            </span>\n                        </div>\n                    </div>\n                `,n.appendChild(s.firstElementChild)})),currentRsvpPage=e)})).catch((e=>{console.error(e)}))}function fetchPrevRsvps(){1!=currentRsvpPage&&fetchRsvps(currentRsvpPage-1)}function fetchNextRsvps(){fetchRsvps(currentRsvpPage+1)}function storeRsvp(e){e.preventDefault();const t=e.target,n=new FormData(t),o=t.querySelector("button[type=submit]");validateRsvp(n.get("invitation_id"),(function(){o.setAttribute("disabled",!0),fetch(`${baseUrl}/rsvps`,{method:"POST",headers:{Accept:"application/json","X-CSRF-TOKEN":csrf},body:n}).then((e=>e.json())).then((()=>{t.reset(),document.querySelector(".guest-count-wrapper select").value="",document.querySelectorAll(".partner-name-wrapper .input-group").forEach((e=>e.remove())),toastSuccess("Thank you for your confirmation and blessing!")})).catch((e=>{console.error(e)})).finally((()=>{o.removeAttribute("disabled")}))}))}function updateRsvp(e){e.preventDefault();const t=e.target,n=new FormData(t),o=t.querySelector("button[type=submit]"),s=n.get("invitation_id");validateRsvpWishes(s,(function(){o.setAttribute("disabled",!0),fetch(`${baseUrl}/rsvps/${s}`,{method:"POST",headers:{Accept:"application/json","X-CSRF-TOKEN":csrf},body:n}).then((e=>e.json())).then((()=>{t.reset(),fetchRsvps(1),toastSuccess("Thank you for your lovely wishes!")})).catch((e=>{console.error(e)})).finally((()=>{o.removeAttribute("disabled")}))}))}function validateRsvp(e,t){fetch(`${baseUrl}/rsvps/check/${e}`).then((e=>e.json())).then((({exists:e})=>{e?toastWarning("You already submitted an RSVP."):t()})).catch((e=>{console.error(e)}))}function validateRsvpWishes(e,t){fetch(`${baseUrl}/rsvps/check/${e}/wishes`).then((e=>e.json())).then((({exists:e})=>{e?toastWarning("You already submitted a wishes message."):t()})).catch((e=>{console.error(e)}))}function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}function playBacksound(){backsound.play(),backsoundToggler.querySelector(".up").classList.remove("d-none"),backsoundToggler.querySelector(".mute").classList.add("d-none")}function pauseBacksound(){backsound.pause(),backsoundToggler.querySelector(".mute").classList.remove("d-none"),backsoundToggler.querySelector(".up").classList.add("d-none")}function toggleBacksound(){backsound.paused?playBacksound():pauseBacksound()}document.addEventListener("DOMContentLoaded",(function(){new Swiper(".swiper-gallery",{spaceBetween:20,slidesPerView:1.2,breakpoints:{1024:{slidesPerView:3}}}),setCountdown(),setInterval((()=>{setCountdown()}),36e5),fetchRsvps()})),window.addEventListener("load",(function(){loading.classList.add("loaded"),setTimeout((()=>{loading.remove()}),500)})),window.addEventListener("scroll",(function(){this.window.scrollY>=300?floatingButtons.style.opacity=1:floatingButtons.style.opacity=0}));